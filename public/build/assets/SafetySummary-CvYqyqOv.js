import{_ as G}from"./Button.vue_vue_type_script_setup_true_lang-DA-5a5tM.js";import{_ as at}from"./Card.vue_vue_type_script_setup_true_lang-DQTQMX6v.js";import{_ as ot}from"./CardContent.vue_vue_type_script_setup_true_lang-DNXZ8J1r.js";import{_ as L}from"./Icon.vue_vue_type_script_setup_true_lang-g5QrAIpa.js";import{r as k,c as m,w as B,A as st,b as rt,e as s,f as C,l as b,u as S,X as t,L as d,k as g,b2 as M,U as l,M as p,N as x,S as E,bW as F}from"./vendor-cgn9wV4E.js";import"./utils-C4uCeQPu.js";import"./vendor-ui-BuPyOEYe.js";import"./vendor-icons-Bu7C1ObZ.js";import"./vendor-vue-C6le94gM.js";import"./vendor-axios-C0Zqfgkc.js";const dt={class:"grid grid-cols-1 md:grid-cols-3 gap-2 md:gap-4"},nt={class:"bg-gradient-to-br from-muted/10 to-muted/30 rounded-lg p-4 shadow-md border border-muted/20 hover:shadow-lg transition-shadow"},it={class:"mt-3 pt-3 border-t border-muted/30"},lt={class:"flex items-center justify-between"},ct={class:"text-2xl font-bold text-indigo-600"},ut={class:"bg-gradient-to-br from-muted/10 to-muted/30 rounded-lg p-4 shadow-md border border-muted/20 hover:shadow-lg transition-shadow"},mt={class:"space-y-2"},ht={key:0},gt={class:"text-foreground"},ft={key:1,class:"text-center text-muted-foreground italic"},vt={class:"bg-gradient-to-br from-muted/10 to-muted/30 rounded-lg p-4 shadow-md border border-muted/20 hover:shadow-lg transition-shadow"},bt={class:"space-y-2"},pt={key:0},xt={class:"text-foreground"},wt={key:1,class:"text-center text-muted-foreground italic"},yt={class:"mt-6"},_t={class:"grid grid-cols-2 md:grid-cols-5 gap-2 md:gap-4"},kt={class:"text-sm text-muted-foreground mb-2"},Ct={class:"text-2xl font-bold text-primary"},St={class:"mt-6"},Mt={class:"grid grid-cols-2 md:grid-cols-5 gap-2 md:gap-4"},Tt={class:"text-sm text-muted-foreground mb-2"},Dt={class:"text-2xl font-bold text-primary"},Vt={key:0,class:"mt-4 text-center"},At={key:1,class:"mt-4"},$t={class:"grid grid-cols-2 md:grid-cols-5 gap-2 md:gap-4"},Zt={class:"text-sm text-muted-foreground mb-2"},jt={class:"text-2xl font-bold text-primary"},It={key:0,class:"mt-6 text-center"},Nt={key:1,class:"mt-6"},Gt={class:"grid grid-cols-1 md:grid-cols-2 gap-2 md:gap-4 lg:gap-6"},Lt={key:0,class:"bg-gradient-to-br from-muted/10 to-muted/30 rounded-lg p-4 shadow-lg border border-muted/20"},Bt={class:"w-full h-64"},Et={class:"flex justify-center items-center h-72"},Ft={class:"w-full h-full"},Kt={__name:"SafetySummary",props:{data:{type:Object,default:()=>({})},activeTab:{type:String,default:""}},setup(i){const c=i,T=k(null),D=k(null);let V=null,A=null;const O=a=>a.replace(/([A-Z])/g," $1").replace(/^./,e=>e.toUpperCase()).trim(),N=a=>a.replace(/([A-Z])/g," $1").replace(/^./,e=>e.toUpperCase()).trim(),f=k(!1),u=k(!1),$=m(()=>Object.entries(c.data.infractions||{}).sort((e,n)=>n[1]-e[1])),z=m(()=>{const a={};return $.value.filter(([e])=>e!=="driverStar").slice(0,5).forEach(([e,n])=>{a[e]=n}),a});m(()=>{const a={};return $.value.slice(0,5).forEach(([e,n])=>{a[e]=n}),a});const Z=m(()=>{const a={};return $.value.filter(([e])=>e!=="driverStar").slice(5).forEach(([e,n])=>{a[e]=n}),a}),R=m(()=>Object.keys(Z.value).length>0),U=m(()=>Object.keys(Z.value).length),P=()=>{f.value=!f.value},W=()=>{u.value=!u.value,u.value&&setTimeout(()=>{w()},100)},H=m(()=>{var a,e,n,o,r,h;return[Math.round(((a=c.data.alerts)==null?void 0:a.distractedDriving)||0),Math.round(((e=c.data.alerts)==null?void 0:e.speeding)||0),Math.round(((n=c.data.alerts)==null?void 0:n.signViolation)||0),Math.round(((o=c.data.alerts)==null?void 0:o.trafficLightViolation)||0),Math.round(((r=c.data.alerts)==null?void 0:r.followingDistance)||0),Math.round(((h=c.data.alerts)==null?void 0:h.roadsideParking)||0)]}),X=m(()=>["Distracted Driving","Speeding","Sign Violations","Traffic Light Violations","Following Distance","Roadside Parking"]),w=()=>{var a,e;if(V&&V.destroy(),A&&A.destroy(),T.value&&c.activeTab!=="yesterday"){const n=T.value.getContext("2d");if(n){const o=((a=c.data.lineChartData)==null?void 0:a.map(v=>v.greenZoneScore))||[],r=o.length>0?Math.min(...o):0,h=o.length>0?Math.max(...o):100,y=h-r,_=y*.1,J=Math.max(0,r-_),K=h+_;V=new F(n,{type:"line",data:{labels:((e=c.data.lineChartData)==null?void 0:e.map(v=>v.date))||[],datasets:[{label:"Green Zone Score",data:o,borderColor:"#10b981",backgroundColor:"rgba(16, 185, 129, 0.1)",tension:.3}]},options:{responsive:!0,maintainAspectRatio:!0,scales:{y:{beginAtZero:!1,min:Math.max(Math.floor(J-75),0),max:Math.min(Math.ceil(K+75),1050),ticks:{stepSize:Math.ceil(y/5)}}},plugins:{tooltip:{callbacks:{label:function(v){const Q=v.raw||0,Y=c.data.greenZoneScore||0,tt=c.data.dateRangeLabel||"selected period",et=Number(Y).toFixed(2);return[`Green Zone Score: ${Q}`,`Average Score Over ${tt}: ${et}`]}}}}}})}}if(D.value){const n=D.value.getContext("2d");n&&(A=new F(n,{type:"doughnut",data:{labels:X.value,datasets:[{data:H.value,backgroundColor:["#061455","#1911B2","#678AC6","#EA0E45","#FF9898","#10b981"],borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,cutout:"60%",plugins:{legend:{position:"bottom",labels:{padding:20,usePointStyle:!0,pointStyle:"circle",boxWidth:10}},tooltip:{callbacks:{label:function(o){const r=o.label||"",h=o.raw||0;return o.dataset.data.reduce((y,_)=>y+_,0),`${r}: ${h}`}}}}}}))}};B(u,a=>{a&&setTimeout(()=>{w()},100)});let j=null;const q=()=>{j&&clearTimeout(j),j=setTimeout(()=>{w()},100)};B(()=>c.data,()=>{u.value&&q()},{deep:!0}),st(()=>{u.value&&setTimeout(()=>{w()},100)});const I=a=>a>=900?"text-green-600":a>=750?"text-yellow-500":a>=600?"text-amber-500":"text-red-600";return(a,e)=>(s(),rt(S(at),{class:"bg-background dark:bg-background border border-muted/30"},{default:C(()=>[b(S(ot),{class:"p-1 md:p-4"},{default:C(()=>{var n;return[t("div",dt,[t("div",nt,[e[1]||(e[1]=t("h3",{class:"text-lg font-semibold text-foreground mb-2"},"Green Zone Score",-1)),t("div",{class:M(["text-4xl font-bold",I(i.data.greenZoneScore)])},l(Math.round(i.data.greenZoneScore)),3),t("div",it,[t("div",lt,[e[0]||(e[0]=t("span",{class:"text-sm text-muted-foreground"},"Driver Star",-1)),t("span",ct,l(Math.round(((n=i.data.infractions)==null?void 0:n.driverStar)||0)),1)])])]),t("div",ut,[e[2]||(e[2]=t("h3",{class:"text-lg font-semibold text-foreground mb-2"},"Top 5 Drivers",-1)),t("div",mt,[i.data.topDrivers&&i.data.topDrivers.length>0?(s(),d("div",ht,[(s(!0),d(p,null,x(i.data.topDrivers,(o,r)=>(s(),d("div",{key:r,class:"flex justify-between items-center"},[t("span",gt,l(o.name),1),t("span",{class:M(["font-medium",I(o.score)])},l(Math.round(o.score)),3)]))),128))])):(s(),d("div",ft," No driver data available "))])]),t("div",vt,[e[3]||(e[3]=t("h3",{class:"text-lg font-semibold text-foreground mb-2"},"Bottom 5 Drivers",-1)),t("div",bt,[i.data.bottomDrivers&&i.data.bottomDrivers.length>0?(s(),d("div",pt,[(s(!0),d(p,null,x(i.data.bottomDrivers,(o,r)=>(s(),d("div",{key:r,class:"flex justify-between items-center"},[t("span",xt,l(o.name),1),t("span",{class:M(["font-medium",I(o.score)])},l(Math.round(o.score)),3)]))),128))])):(s(),d("div",wt," No driver data available "))])])]),t("div",yt,[e[4]||(e[4]=t("h3",{class:"text-lg font-semibold text-foreground mb-4"},"Total Severe Alerts",-1)),t("div",_t,[(s(!0),d(p,null,x(i.data.alerts,(o,r)=>(s(),d("div",{key:r,class:"bg-gradient-to-br from-muted/10 to-muted/30 rounded-lg p-2 md:p-4 text-center shadow-md border border-muted/20 hover:shadow-lg transition-shadow"},[t("div",kt,l(O(r)),1),t("div",Ct,l(Math.floor(o)),1)]))),128))])]),t("div",St,[e[5]||(e[5]=t("h3",{class:"text-lg font-semibold text-foreground mb-4"}," Other Severe Safety Infractions ",-1)),t("div",Mt,[(s(!0),d(p,null,x(z.value,(o,r)=>(s(),d("div",{key:r,class:"bg-gradient-to-br from-muted/10 to-muted/30 rounded-lg p-2 md:p-4 text-center shadow-md border border-muted/20 hover:shadow-lg transition-shadow"},[t("div",Tt,l(N(r)),1),t("div",Dt,l(Math.round(o)),1)]))),128))]),R.value?(s(),d("div",Vt,[b(S(G),{onClick:P,variant:"outline",class:"w-full md:w-auto shadow-sm hover:shadow transition-shadow"},{default:C(()=>[b(L,{name:f.value?"chevron-up":"chevron-down",class:"mr-2 h-4 w-4"},null,8,["name"]),E(" "+l(f.value?"Show Less":`Show ${U.value} More`),1)]),_:1})])):g("",!0),f.value?(s(),d("div",At,[t("div",$t,[(s(!0),d(p,null,x(Z.value,(o,r)=>(s(),d("div",{key:r,class:"bg-gradient-to-br from-muted/10 to-muted/30 rounded-lg p-2 md:p-4 text-center shadow-md border border-muted/20 hover:shadow-lg transition-shadow"},[t("div",Zt,l(N(r)),1),t("div",jt,l(Math.round(o)),1)]))),128))])])):g("",!0)]),i.activeTab!=="yesterday"?(s(),d("div",It,[b(S(G),{onClick:W,variant:"outline",class:"w-full md:w-auto shadow-sm hover:shadow transition-shadow"},{default:C(()=>[b(L,{name:u.value?"eye-off":"eye",class:"mr-2 h-4 w-4"},null,8,["name"]),E(" "+l(u.value?"Hide Graphs":"Show Graphs"),1)]),_:1})])):g("",!0),u.value?(s(),d("div",Nt,[t("div",Gt,[i.activeTab!=="yesterday"?(s(),d("div",Lt,[e[6]||(e[6]=t("h3",{class:"text-lg font-semibold text-foreground mb-4"},"Safety Trends",-1)),t("div",Bt,[t("canvas",{ref_key:"lineChartCanvas",ref:T,width:"400",height:"200"},null,512)])])):g("",!0),i.activeTab!=="yesterday"?(s(),d("div",{key:1,class:M([{"md:col-span-2":i.activeTab==="yesterday"},"bg-gradient-to-br from-muted/10 to-muted/30 rounded-lg p-4 shadow-lg border border-muted/20"])},[e[7]||(e[7]=t("h3",{class:"text-lg font-semibold text-foreground mb-4"},"Alert Distribution",-1)),t("div",Et,[t("div",Ft,[t("canvas",{ref_key:"doughnutChartCanvas",ref:D,width:"200",height:"200"},null,512)])])],2)):g("",!0)])])):g("",!0)]}),_:1})]),_:1}))}};export{Kt as default};
